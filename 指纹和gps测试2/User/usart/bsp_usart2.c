/**
  ******************************************************************************
  * @file    bsp_as608.c
  * @author  fire
  * @version V1.0
  * @date    2013-xx-xx
  * @brief   指纹识别模块实验
  ******************************************************************************
  * @attention
  *
  * 实验平台:秉火STM32 F103-霸道 开发板  
  * 论坛    :http://www.firebbs.cn
  * 淘宝    :https://fire-stm32.taobao.com
  *
  ******************************************************************************
  */ 
	
#include "./as608/bsp_as608.h"
#include "./usart/rx_data_queue.h"
#include "./SysTick/bsp_SysTick.h"
#include "./usart/bsp_usart1.h" 
#include <stdarg.h>




 /**
  * @brief  配置嵌套向量中断控制器NVIC
  * @param  无
  * @retval 无
  */	
static void NVIC_Configuration(void)
{
  NVIC_InitTypeDef NVIC_InitStructure;
  
  /* 嵌套向量中断控制器组选择 */
  NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);
  
  /* 配置USART为中断源 */
  NVIC_InitStructure.NVIC_IRQChannel = USART2_IRQn;
  /* 抢断优先级*/
  NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 1;
  /* 子优先级 */
  NVIC_InitStructure.NVIC_IRQChannelSubPriority = 1;
  /* 使能中断 */
  NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
  /* 初始化配置NVIC */
  NVIC_Init(&NVIC_InitStructure);
  /* 配置中断源：TouchOut线 */
  NVIC_InitStructure.NVIC_IRQChannel = EXTI4_IRQn;
    /* 抢断优先级*/
  NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 1;
  /* 配置子优先级 */
  NVIC_InitStructure.NVIC_IRQChannelSubPriority = 2;
  /* 初始化配置NVIC */
  NVIC_Init(&NVIC_InitStructure); 
}


  /**
  * @brief  AS608_TouchOut配置
  * @param  无
  * @retval 无
  */
void AS608_Config(void)
{
	GPIO_InitTypeDef GPIO_InitStructure; 
	EXTI_InitTypeDef EXTI_InitStructure;
  USART_InitTypeDef USART_InitStructure;
  
	/*开启串口GPIO口的时钟*/
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA|RCC_APB2Periph_AFIO,ENABLE);
  AS608_USART_GPIO_APBxClkCmd((RCC_APB2Periph_GPIOA), ENABLE);
  /*打开串口外设的时钟*/
	AS608_USART_APBxClkCmd(RCC_APB1Periph_USART2, ENABLE);
												
	/* 配置 NVIC 中断*/
	NVIC_Configuration();
  
	/* TouchOut线用到的GPIO */	
  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_4;
  /* 配置为浮空输入 */	
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN_FLOATING;
  GPIO_Init(GPIOA, &GPIO_InitStructure);

	/* 选择EXTI的信号源 */
  GPIO_EXTILineConfig(GPIO_PortSourceGPIOA, GPIO_PinSource4); 
  EXTI_InitStructure.EXTI_Line = EXTI_Line4;
	
	/* EXTI为中断模式 */
  EXTI_InitStructure.EXTI_Mode = EXTI_Mode_Interrupt;
	/* 上升/下降沿中断 */
  EXTI_InitStructure.EXTI_Trigger =EXTI_Trigger_Rising_Falling;
  /* 使能中断 */	
  EXTI_InitStructure.EXTI_LineCmd = ENABLE;
  EXTI_Init(&EXTI_InitStructure);
  
  /*将USART Tx的GPIO配置为推挽复用模式*/
  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_2;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
	GPIO_Init(GPIOA, &GPIO_InitStructure);

  /*将USART Rx的GPIO配置为浮空输入模式*/
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_3;
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN_FLOATING;
	GPIO_Init(GPIOA, &GPIO_InitStructure);
	
	/*配置串口的工作参数*/
	/*配置波特率*/
	USART_InitStructure.USART_BaudRate = 57600;
	/*配置 针数据字长*/
	USART_InitStructure.USART_WordLength = USART_WordLength_8b;
	/*配置停止位*/
	USART_InitStructure.USART_StopBits = USART_StopBits_1;
	/*配置校验位*/
	USART_InitStructure.USART_Parity = USART_Parity_No ;
	/*配置硬件流控制*/
	USART_InitStructure.USART_HardwareFlowControl = 
	                                USART_HardwareFlowControl_None;
	/*配置工作模式，收发一起*/
	USART_InitStructure.USART_Mode = USART_Mode_Rx | USART_Mode_Tx;
	/*完成串口的初始化配置*/
	USART_Init(USART2, &USART_InitStructure);
	
	/*使能串口接收中断*/
	USART_ITConfig(USART2, USART_IT_RXNE, ENABLE);	
	USART_ITConfig(USART2, USART_IT_IDLE, ENABLE ); //使能串口总线空闲中断 	
	
	/*使能串口*/
	USART_Cmd(USART2, ENABLE);	
 	
}






/*********************************************END OF FILE**********************/

